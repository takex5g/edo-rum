# 江戸走りポーズ検出 Web アプリ

## 概要

カメラから取得した映像を MediaPipe Pose で解析し、江戸走りのポーズ（片手を前に出した走るポーズ）を検出した際に BGM を再生する Web アプリケーションです。

## 技術スタック

- yarn
- TypeScript
- Vite + React
- MediaPipe Pose

## 実装内容

### 主要機能

#### ポーズ検出ロジック

- MediaPipe Pose を使用して人体の骨格を検出
- 江戸走りのポーズ判定：
  - 片手（左手または右手）が前に伸びている
  - 反対側の手が後ろに引かれている
  - 走るような姿勢（膝が曲がっている）
- 江戸走りのポーズは、 ./江戸走り.png を参考
- ポーズが一定時間（例：1 秒）継続したら BGM を再生

#### 音声制御

- ポーズ検出時に BGM を再生開始
- ポーズが解除されたら BGM を停止またはフェードアウト
- 複数回検出時の重複再生を防止
- BGM は bgm/江戸走り.wav を使用

#### UI 要素

- カメラ映像の表示
- ポーズ検出状態の表示（検出中/未検出）
- カメラの開始/停止ボタン

### ポーズ判定アルゴリズム

江戸走りのポーズは以下の条件で判定：

- 片方の腕が前方に伸びている（肩 → 肘 → 手首の角度が一定範囲内）
- 反対側の腕が後方に引かれている
- 両膝が曲がっている（走る姿勢）
- 体が前傾している

### テスト用入力

- AI のテスト時は実カメラではなく `江戸走り.png` を入力として使用
- 誤検知確認用に `走ってない.png` を用意

## 実装タスクチェックリスト

- [ ] Vite + React + TypeScript + yarn の初期化
- [ ] `bgm/江戸走り.wav` と `江戸走り.png` を配置
- [ ] `走ってない.png` を配置
- [ ] テスト用画像入力モード（カメラ切替）を実装
- [ ] カメラ取得（`getUserMedia`）と `<video>` 表示
- [ ] カメラ開始/停止ボタンの実装
- [ ] MediaPipe Pose の導入と推論ループ
- [ ] ランドマークの信頼度フィルタ
- [ ] 角度計算ユーティリティの作成
- [ ] ポーズ判定（腕の前後・膝・前傾）の条件化
- [ ] 一定時間継続の判定ロジック
- [ ] 検出状態の UI 表示
- [ ] BGM の再生/停止/フェードアウト制御
- [ ] 重複再生の抑止（状態遷移）
- [ ] カメラ拒否などのエラー表示
- [ ] 実機で閾値の調整
- [ ] 動作確認
